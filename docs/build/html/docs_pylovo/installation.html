<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation &mdash; pylovo 2024 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Municipal Register" href="municipal_register/municipal_register.html" />
    <link rel="prev" title="pylovo" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pylovo
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-package">Install package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#user">User</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data">Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#developer">Developer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-installation-database-construction">Advanced installation - Database construction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-postgresql-on-linux">Install postgresql on linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="#access-database">Access Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#outside-the-server-from-ssh-client-a-k-a-your-own-computer">Outside the server (from ssh client a.k.a. your own computer)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#create-sql-functions">Create SQL functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#load-raw-data-to-the-database">Load raw data to the database</a></li>
<li class="toctree-l2"><a class="reference internal" href="#input-data-model">Input data model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preprocess-ways-from-osm-data">Preprocess ways from OSM data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#further-input-data">Further Input Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="municipal_register/municipal_register.html">Municipal Register</a></li>
<li class="toctree-l3"><a class="reference internal" href="osm_trafos.html">Preprocess transformers from OSM data (Optional)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../grid_generation/index.html">Grid Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../classification/index.html">Classification of Pylovo Grids</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualisation/index.html">Visualisation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pylovo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Installation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/docs_pylovo/installation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this heading"></a></h1>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Environment: We strongly recommend setting up virtual environments for pylovo (and the urbs optimizer if the gui shall be used).</p></li>
<li><p><a class="reference external" href="https://doku.lrz.de/vpn-eduvpn-installation-und-konfiguration-11491448.html?showLanguage=en_GB">EduVPN</a>: If you are working from your own machine you will need a VPN to connect to the MWN network. A connection to the network is necessary for accessing the database server.</p></li>
</ul>
</section>
<section id="install-package">
<h2>Install package<a class="headerlink" href="#install-package" title="Permalink to this heading"></a></h2>
<div class="line-block">
<div class="line">pylovo is developed as a Python package and can be installed with pip, ideally by using a virtual environment.</div>
<div class="line">Start by cloning the repository from Github to a directory of your choice. The following command pulls the repository as well as the urbs submodule</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">recurse</span><span class="o">-</span><span class="n">submodules</span> <span class="o">--</span><span class="n">remote</span><span class="o">-</span><span class="n">submodules</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tum</span><span class="o">-</span><span class="n">ens</span><span class="o">/</span><span class="n">pylovo</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>Next we set up our virtual environments. If you are able to use python with version from the terminal such as
<a href="#id1"><span class="problematic" id="id2">``</span></a>python3.9``you can set up a virtual environment with that version following this command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span><span class="mf">.9</span> <span class="o">-</span><span class="n">m</span> <span class="n">venv</span> <span class="n">pylovovenv</span>
</pre></div>
</div>
<p>You can also use virtualenv as an alternative to use the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">virtualenv</span> <span class="n">pylovovenv</span> <span class="o">--</span><span class="n">python</span><span class="o">=</span><span class="n">python3</span><span class="mf">.9</span>
</pre></div>
</div>
<p>You can then activate the environments by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># to activate a virtual environment</span>
<span class="n">source</span> <span class="n">pylovovenv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="c1"># to deactivate a virtual environment:</span>
<span class="n">deactivate</span>
</pre></div>
</div>
<p>Finally, after activating the virtual environment that we crated. We install pylovo from the local repository.
There are additional setup options for different user groups. Such as developers, which includes packages for documentation.
Gui users, which includes packages for the web interface and testing which includes packages for testing the code.
Both installation option steps are described below.
See inside <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> for more detailed information and which packages to select when installing.</p>
<section id="user">
<h3>User<a class="headerlink" href="#user" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># navigate to pylovo main code folder</span>
<span class="n">cd</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">git_repo</span><span class="o">/</span><span class="n">pylovo</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
</pre></div>
</div>
<p>With this setup you are already ready to use the main constructor to create the tables and load the data into the database.
Then you can use the grid generator scripts to create grids.</p>
</section>
<section id="data">
<h3>Data<a class="headerlink" href="#data" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>You should contact the responsible person (see author_email in setup.py) to get the raw data and place them in the correct folders.
The essential files are:</p>
<blockquote>
<div><ul class="simple">
<li><p>building data for residential and other sectors: res.shp and oth.shp</p></li>
<li><p>ways data: public_2po_4pgr.sql</p></li>
<li><p>transformer data (optional): substations.geojson</p></li>
</ul>
</div></blockquote>
<p>For the transformer files you need to do additional configuration in <code class="docutils literal notranslate"><span class="pre">raw_data/proccess_trafos.py</span></code>.</p>
</div></blockquote>
</section>
<section id="developer">
<h3>Developer<a class="headerlink" href="#developer" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># navigate to pylovo main code folder</span>
<span class="n">cd</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">git_repo</span><span class="o">/</span><span class="n">pylovo</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span><span class="s2">&quot;[dev]&quot;</span>
</pre></div>
</div>
<p>to use the gui, make it .”[gui]” or add it to the list like .”[dev, gui]”.</p>
<p>If you have included the gui in the setup, with that pylovo should be ready to go! You can test whether everything went correctly by navigating
to the IDP_Maptool_Flask folder and running the following commands</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># navigate to maptool folder and start web server</span>
<span class="n">cd</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">repo</span><span class="o">/</span><span class="n">pylovo</span><span class="o">/</span><span class="n">gui</span><span class="o">/</span><span class="n">IDP_Maptool_Flask</span>
<span class="n">flask</span> <span class="o">--</span><span class="n">app</span> <span class="n">maptool</span> <span class="o">--</span><span class="n">debug</span> <span class="n">run</span>
</pre></div>
</div>
<p>This should start the flask server and allow you to open the GUI by navigating to <a class="reference external" href="http:127.0.0.1:5000">http:127.0.0.1:5000</a> in a web browser of your choice</p>
</section>
</section>
<section id="advanced-installation-database-construction">
<h2>Advanced installation - Database construction<a class="headerlink" href="#advanced-installation-database-construction" title="Permalink to this heading"></a></h2>
<div class="line-block">
<div class="line">Follow the instructions below, only if you want to create a new database for pylovo.
Make sure you have the required raw data.</div>
</div>
<div class="line-block">
<div class="line">Make sure that you have created the database with the proper config of dbname, user, password, host, port in the config_data.py file.</div>
</div>
</section>
<section id="install-postgresql-on-linux">
<h2>Install postgresql on linux<a class="headerlink" href="#install-postgresql-on-linux" title="Permalink to this heading"></a></h2>
<div class="line-block">
<div class="line">To install postgreSQL to your machine see the editions from here</div>
<div class="line"><a class="reference external" href="https://www.postgresql.org/download/">https://www.postgresql.org/download/</a></div>
</div>
</section>
<section id="access-database">
<h2>Access Database<a class="headerlink" href="#access-database" title="Permalink to this heading"></a></h2>
<section id="outside-the-server-from-ssh-client-a-k-a-your-own-computer">
<h3>Outside the server (from ssh client a.k.a. your own computer)<a class="headerlink" href="#outside-the-server-from-ssh-client-a-k-a-your-own-computer" title="Permalink to this heading"></a></h3>
<div class="line-block">
<div class="line">To gain access to the pylovo database from your own machine you will need to request a username and password from the ENS chair.</div>
<div class="line">If you are working from your own machine you will also need to utilize a VPN to connect to the MWN network,
which us a prerequisite for connecting to the database server. We recommend using <a class="reference external" href="https://doku.lrz.de/vpn-eduvpn-installation-und-konfiguration-11491448.html?showLanguage=en_GB">EduVPN</a> for this purpose.
Follow the instructions in the link to set up a connection. You will need to use EduVPN to connect to the profile
<strong>Technische Universität München via LRZ-VPN</strong>.</div>
</div>
<div class="line-block">
<div class="line">Once you have connected via EduVPN the tool will be able to connect to the database automatically</div>
</div>
</section>
</section>
<section id="create-sql-functions">
<h2>Create SQL functions<a class="headerlink" href="#create-sql-functions" title="Permalink to this heading"></a></h2>
<p>Prewritten SQL functions must be created for once, this will be done by the <code class="docutils literal notranslate"><span class="pre">main_constructor</span></code>, so this step can be skipped to use that script.
Constructor uses the dump_functions file in syngrid folder, for a detailed view on this it can be checked from that path.
If you had a problem or if you prefer to do so run the file syngrid/dump_functions.sql:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">psql</span> <span class="o">-</span><span class="n">d</span> <span class="n">syngrid_db</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">f</span> <span class="s2">&quot;syngrid/dump_functions.sql&quot;</span>
</pre></div>
</div>
</section>
<section id="load-raw-data-to-the-database">
<h2>Load raw data to the database<a class="headerlink" href="#load-raw-data-to-the-database" title="Permalink to this heading"></a></h2>
<div class="line-block">
<div class="line">pylovo requires the correct table structure and input data to already be loaded into the database.
Make sure that you have the raw data files and paths configured in config_data.py</div>
<div class="line">To create the <code class="docutils literal notranslate"><span class="pre">public_2po_4pgr</span></code> table you need to put that file into raw_data folder before running the constructor.</div>
<div class="line">Make sure again you have created the database, configured with the proper dbname, user, password, host, port in the config_data.py file including the permissions.</div>
<div class="line">Afterwards, being in the root folder of the repository, the ETL process can be executed as:</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">executable_scripts</span><span class="o">/</span><span class="n">main_constructor</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</section>
<section id="input-data-model">
<h2>Input data model<a class="headerlink" href="#input-data-model" title="Permalink to this heading"></a></h2>
<p>The minimum data model is described below:</p>
<ul class="simple">
<li><p>res</p></li>
<li><p>oth</p></li>
<li><p>betriebsmittel</p></li>
<li><p>postcode</p></li>
<li><p>ways</p></li>
<li><p>consumer_categories</p></li>
<li><p>transformers</p></li>
</ul>
<section id="preprocess-ways-from-osm-data">
<h3>Preprocess ways from OSM data<a class="headerlink" href="#preprocess-ways-from-osm-data" title="Permalink to this heading"></a></h3>
<div class="line-block">
<div class="line">Use the following steps if you want to add more ways in addition to the default Bavarian ways that</div>
<div class="line">are provided with the public_2po_4pgr.sql file and are set from the <code class="docutils literal notranslate"><span class="pre">main_constructor.py</span></code></div>
</div>
<ol class="arabic simple">
<li><p>Connect to database via localhost</p></li>
<li><p>Download the OSM-streetnets you require from <a class="reference external" href="http://download.geofabrik.de/">http://download.geofabrik.de/</a></p></li>
<li><dl class="simple">
<dt>Download Osm2po-5.3.6 from <a class="reference external" href="https://osm2po.de/releases/">https://osm2po.de/releases/</a></dt><dd><ul class="simple">
<li><p>!!!Has to be version 5.3.6, this guide does not work with later versions!!!</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Extract the downloaded zip file</p></li>
<li><dl class="simple">
<dt>Open the osm2po.config file in the extracted folder and make sure that all of the following lines are set correctly (lines starting with # are commented out)</dt><dd><ul class="simple">
<li><p>Line 59:          tilesize=x</p></li>
<li><p>Line 190:         comment out “.default.wtr.finalMask = car”</p></li>
<li><p>Line 222-231:     make sure that only ferry is commented out</p></li>
<li><p>Line 341:         line must not be commented out, otherwise sql file will not be generated</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Open terminal and navigate to folder Osm2po-5.3.6. Execute the following command:</dt><dd><ul class="simple">
<li><p>java -Xmx1g -jar osm2po-core-5.3.6-signed.jar prefix=public “C:/Users/path/to/osm/file/osm_file_name.pbf”</p></li>
<li><p>change „C:/Users/path/to/osm/file/“ with path to geofabrik file you downloaded earlier</p></li>
<li><p>change „osm_file_name.pbf“ to name of the geofabrik file</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Execute pylovo’s main_constructor.py</dt><dd><ul class="simple">
<li><p>make sure the ways_to_db method has been uncommented in main_constructor.py</p></li>
<li><p>the ways in the 2po_4pgr table will be inserted into the ways table and can now be used by pylovo</p></li>
</ul>
</dd>
</dl>
</li>
</ol>
</section>
</section>
<section id="further-input-data">
<h2>Further Input Data<a class="headerlink" href="#further-input-data" title="Permalink to this heading"></a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="municipal_register/municipal_register.html">Municipal Register</a><ul>
<li class="toctree-l2"><a class="reference internal" href="municipal_register/municipal_register.html#gemeindeverzeichnis">Gemeindeverzeichnis</a></li>
<li class="toctree-l2"><a class="reference internal" href="municipal_register/municipal_register.html#regiostar">Regiostar</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="osm_trafos.html">Preprocess transformers from OSM data (Optional)</a></li>
</ul>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="pylovo" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="municipal_register/municipal_register.html" class="btn btn-neutral float-right" title="Municipal Register" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Beneharo Reveron Baecker.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>